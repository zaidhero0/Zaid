name: Free Linux CPU Runner

on:
  workflow_dispatch:

jobs:
  cpu-runner:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Show CPU Info
        run: |
          echo "CPU INFO:"
          lscpu

      - name: Stress Test CPU
        run: |
          echo "Starting CPU workload..."
          nproc=$(nproc)
          echo "Using $nproc cores"

          # Simple CPU load for testing (6 minutes)
          timeout 360s bash -c "for i in $(seq 1 $nproc); do yes > /dev/null & done; wait"

      - name: List Disk & Memory
        run: |
          echo "Disk usage:"
          df -h
          echo "Memory:"
          free -h

      - name: Keep Runner Alive
        run: |
          echo "Runner will stay active (logs updated every minute)..."
          for i in {1..6}; do
            echo "[$(date)] Runner alive..."
            sleep 60
          done


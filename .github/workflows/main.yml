name: Free GPU Gaming VPS (Google Colab)

on:
  workflow_dispatch:
    inputs:
      session_duration:
        description: 'Max session duration (hours - Colab free = 12hrs max)'
        required: true
        default: '6'
        type: choice
        options:
          - '2'
          - '4'
          - '6'
          - '12'

jobs:
  setup-free-gaming-vps:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install jupyter notebook
          pip install pyngrok
          pip install --upgrade google-colab

      - name: Create Colab Gaming Notebook
        run: |
          cat > gaming_vps.ipynb << 'EOF'
          {
            "nbformat": 4,
            "nbformat_minor": 0,
            "metadata": {
              "colab": {
                "provenance": [],
                "gpuType": "T4"
              },
              "kernelspec": {
                "name": "python3",
                "display_name": "Python 3"
              },
              "accelerator": "GPU"
            },
            "cells": [
              {
                "cell_type": "markdown",
                "metadata": {},
                "source": ["# ğŸ® Free GPU Gaming VPS Setup\n", "**FREE Google Colab GPU (Tesla T4)**\n\n", "Session time: Up to 12 hours free"]
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "# Step 1: Check GPU availability\n",
                  "!nvidia-smi\n",
                  "print('\\nâœ… GPU is available!')"
                ],
                "execution_count": null,
                "outputs": []
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "# Step 2: Install VNC and Desktop Environment\n",
                  "!apt update\n",
                  "!apt install -y xfce4 xfce4-goodies\n",
                  "!apt install -y tightvncserver dbus-x11\n",
                  "!apt install -y novnc python3-websockify python3-numpy\n",
                  "print('\\nâœ… Desktop environment installed!')"
                ],
                "execution_count": null,
                "outputs": []
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "# Step 3: Install Gaming Software\n",
                  "import os\n",
                  "\n",
                  "# Install Wine for Windows games\n",
                  "!dpkg --add-architecture i386\n",
                  "!apt update\n",
                  "!apt install -y wine64 wine32 winetricks\n",
                  "\n",
                  "# Install Steam\n",
                  "!wget https://steamcdn-a.akamaihd.net/client/installer/steam.deb\n",
                  "!dpkg -i steam.deb || apt --fix-broken install -y\n",
                  "\n",
                  "print('\\nâœ… Gaming software installed!')"
                ],
                "execution_count": null,
                "outputs": []
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "# Step 4: Setup ngrok tunnel for remote access\n",
                  "!pip install pyngrok\n",
                  "\n",
                  "from pyngrok import ngrok, conf\n",
                  "import getpass\n",
                  "\n",
                  "# Get ngrok auth token (FREE at ngrok.com)\n",
                  "print('Get your FREE ngrok token at: https://dashboard.ngrok.com/get-started/your-authtoken')\n",
                  "ngrok_token = getpass.getpass('Enter your ngrok auth token: ')\n",
                  "conf.get_default().auth_token = ngrok_token\n",
                  "\n",
                  "# Set VNC password\n",
                  "vnc_password = getpass.getpass('Set VNC password (6-8 chars): ')\n",
                  "os.system(f'echo {vnc_password} | vncpasswd -f > /root/.vnc/passwd')\n",
                  "os.system('chmod 600 /root/.vnc/passwd')\n",
                  "\n",
                  "print('\\nâœ… Security configured!')"
                ],
                "execution_count": null,
                "outputs": []
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "# Step 5: Start VNC Server\n",
                  "!vncserver :1 -geometry 1920x1080 -depth 24\n",
                  "\n",
                  "# Start noVNC (web-based VNC client)\n",
                  "!nohup /usr/share/novnc/utils/novnc_proxy --vnc localhost:5901 --listen 6080 &\n",
                  "\n",
                  "print('\\nâœ… VNC server started on port 5901')\n",
                  "print('âœ… noVNC web interface on port 6080')"
                ],
                "execution_count": null,
                "outputs": []
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "# Step 6: Create ngrok tunnel\n",
                  "vnc_tunnel = ngrok.connect(5901, 'tcp')\n",
                  "web_tunnel = ngrok.connect(6080, 'http')\n",
                  "\n",
                  "print('\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')\n",
                  "print('ğŸ® FREE GPU GAMING VPS - CONNECTION INFO')\n",
                  "print('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”')\n",
                  "print(f'\\nğŸ’» GPU: Tesla T4 (16GB VRAM)')\n",
                  "print(f'â±ï¸  Session: Up to 12 hours free')\n",
                  "print(f'\\nğŸ”— VNC Connection:')\n",
                  "print(f'   Address: {vnc_tunnel.public_url.replace(\"tcp://\", \"\")}')\n",
                  "print(f'   Password: [your VNC password]')\n",
                  "print(f'\\nğŸŒ Web Browser Access (easier):')\n",
                  "print(f'   URL: {web_tunnel.public_url}')\n",
                  "print(f'   Password: [your VNC password]')\n",
                  "print(f'\\nğŸ“ Download VNC Viewer: https://www.realvnc.com/download/viewer/')\n",
                  "print('\\nâš ï¸  Keep this cell running to maintain connection!')\n",
                  "print('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n')\n",
                  "\n",
                  "# Keep alive\n",
                  "import time\n",
                  "try:\n",
                  "    while True:\n",
                  "        time.sleep(60)\n",
                  "except KeyboardInterrupt:\n",
                  "    print('\\nğŸ›‘ Stopping VPS...')\n",
                  "    ngrok.kill()"
                ],
                "execution_count": null,
                "outputs": []
              }
            ]
          }
          EOF
          
          echo "âœ… Gaming notebook created!"

      - name: Upload Colab Notebook
        uses: actions/upload-artifact@v3
        with:
          name: gaming-vps-notebook
          path: gaming_vps.ipynb

      - name: Display Instructions
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ® FREE GPU GAMING VPS - SETUP INSTRUCTIONS"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“¥ STEP 1: Download the notebook"
          echo "   â€¢ Go to Actions tab â†’ This workflow run"
          echo "   â€¢ Download 'gaming-vps-notebook' artifact"
          echo ""
          echo "ğŸš€ STEP 2: Open in Google Colab (FREE)"
          echo "   â€¢ Go to: https://colab.research.google.com"
          echo "   â€¢ Click 'Upload' and select gaming_vps.ipynb"
          echo "   â€¢ Enable GPU: Runtime â†’ Change runtime type â†’ GPU (T4)"
          echo ""
          echo "ğŸ¯ STEP 3: Get FREE ngrok account"
          echo "   â€¢ Sign up at: https://ngrok.com (100% FREE)"
          echo "   â€¢ Get your auth token from dashboard"
          echo ""
          echo "â–¶ï¸  STEP 4: Run all cells in the notebook"
          echo "   â€¢ Each cell will setup gaming environment"
          echo "   â€¢ Final cell gives you connection URL"
          echo ""
          echo "ğŸ® WHAT YOU GET FOR FREE:"
          echo "   â€¢ NVIDIA Tesla T4 GPU (16GB VRAM)"
          echo "   â€¢ 12 hours continuous session"
          echo "   â€¢ Steam, Wine, Desktop environment"
          echo "   â€¢ Remote access via browser or VNC"
          echo ""
          echo "ğŸ’¡ ALTERNATIVE FREE OPTIONS:"
          echo "   â€¢ Kaggle Notebooks (30hrs/week GPU free)"
          echo "   â€¢ Paperspace Gradient (6hrs GPU free)"
          echo "   â€¢ Google Cloud (300$ free credit)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

